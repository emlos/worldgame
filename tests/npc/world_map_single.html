<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Single Map & Schedule Test</title>
    <script>
        const debug = true;
    </script>
    <script type="module" src="../../src/classes/classes.js"></script>
    <script type="module" src="../../src/data/data.js"></script>
    <script type="module" src="../../src/shared/modules.js"></script>
</head>

<style>
    :root {
        --bg: #0b0d10;
        --fg: #e6ecf1;
        --muted: #91a4b1;
        --card: #11161b;
        --line: #26323b;
        --map-bg: #050608;
        --accent: #2d6cdf;
    }

    html,
    body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--fg);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        height: 100%;
    }

    * {
        box-sizing: border-box;
    }

    .page {
        margin: 0 auto;
        padding: 16px;
        display: grid;
        grid-template-columns: minmax(0, 2fr) minmax(0, 3fr);
        gap: 16px;
    }

    h1 {
        margin-top: 0;
        font-size: 24px;
    }

    .subtitle {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 16px;
    }

    .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 16px;
        margin: 12px 0;
    }

    button {
        background: var(--accent);
        border: none;
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 8px;
        margin-bottom: 6px;
    }

    button:hover {
        filter: brightness(1.1);
    }

    #map svg {
        display: block;
    }

    #map line.road-edge--highlight {
        stroke-width: 5;
        filter: brightness(2);
    }

    .info-row {
        font-size: 14px;
        margin: 4px 0;
    }

    .info-row span.label {
        color: var(--muted);
        margin-right: 4px;
    }

    code {
        background: #020305;
        padding: 2px 4px;
        border-radius: 4px;
        font-size: 12px;
    }

    #taylorNextIntent {
        text-decoration: underline dotted;
        cursor: help;
    }

    #weekSchedule {
        font-size: 12px;
        max-height: 400px;
        overflow: auto;
        border-radius: 8px;
        padding: 8px;
        background: rgba(2, 4, 7, 0.5);
        border: 1px solid var(--line);
        white-space: pre-wrap;
    }

    h3.schedule-day {
        font-weight: 600;
        margin-top: 6px;
        margin-bottom: 2px;
        color: var(--fg);
        font-size: larger;
    }

    label {
        font-size: 12px;
        color: var(--muted);
    }

    .cfg-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: end;
        margin-bottom: 10px;
    }

    .cfg-row label {
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 140px;
    }

    .cfg-row input,
    .cfg-row select {
        background: #0d1216;
        border: 1px solid var(--line);
        border-radius: 8px;
        color: var(--fg);
        padding: 8px 10px;
        min-width: 140px;
    }
</style>

<body>
    <a href="../../index.html">back</a>

    <div class="page">
        <div>
            <div class="card">
                <h1><span id="npcTitleName">NPC</span> - Map & Schedule Test</h1>
                <p class="subtitle">
                    Reproducible single-NPC inspector. Use the controls (or URL params) to match fuzz failures.
                </p>

                <div class="cfg-row">
                    <label>
                        NPC key
                        <select id="cfgNpc"></select>
                    </label>

                    <label>
                        Seed
                        <input id="cfgSeed" type="number" step="1" />
                    </label>

                    <label>
                        Density
                        <input id="cfgDensity" type="number" min="0.01" max="1" step="0.01" value="0.15" />
                    </label>

                    <label>
                        World W
                        <input id="cfgW" type="number" min="10" step="1" value="70" />
                    </label>

                    <label>
                        World H
                        <input id="cfgH" type="number" min="10" step="1" value="50" />
                    </label>

                    <label>
                        Start date
                        <input id="cfgStartDate" type="date" />
                    </label>

                    <div style="display:flex; gap:8px; flex-wrap:wrap">
                        <button id="btnApplyConfig">Load</button>
                        <button id="btnCopyLink">Copy link</button>
                    </div>
                </div>

                <div class="info-row">
                    <span class="label">World time:</span>
                    <span id="worldTime">—</span>
                </div>
                <div class="info-row">
                    <span class="label">Day info:</span>
                    <span id="dayType">—</span>
                </div>

                <div class="info-row">
                    <span class="label">Current location:</span>
                    <span id="taylorCurrent">—</span><br />
                    <span class="label">Places at Current Location:</span>
                    <span id="placesAtLoc"></span>
                </div>
                <div class="info-row">
                    <span class="label">Home location:</span>
                    <span id="taylorHome">—</span>
                </div>

                <div class="info-row">
                    <span class="label">Next 30 min intent:</span>
                    <span id="taylorNextIntent">—</span>
                </div>

                <p style="margin-top: 2px; font-size: 11px; color: var(--muted)">
                    Hover the intent text to highlight the planned target location on the map.
                </p>

                <div style="margin-top: 12px; display: flex; flex-direction: row">
                    <button id="btnTimePlus1">+1 min</button>
                    <button id="btnTimePlus30">+30 min</button>
                    <button id="btnTimePlus120">+2 hours</button>
                    <button id="btnTimePlusWeek">+1 week</button>
                    <button id="btnResetWorld">New random seed</button>

                    <div style="display: flex; flex-direction: column; flex-grow: 1">
                        <button id="btnAutoForward">Play Schedule</button>
                        <div style="display: flex; flex-direction: row">
                            <label for="speedSlider" id="speedLabel" style="white-space: nowrap">Speed 1
                                s/min</label>&nbsp;
                            <input type="range" min="1" max="500" value="1" class="slider" id="speedSlider"
                                style="width: 100%" />
                        </div>
                    </div>
                </div>

                <p style="margin-top: 8px; font-size: 12px; color: var(--muted)">
                    On the map: <code>yellow</code> = current location, <code>green outline</code> = home.
                    Click any node to teleport the NPC there manually.
                </p>
            </div>

            <div class="card">
                <h2 style="margin-top: 0; font-size: 16px">Current week schedule</h2>
                <p style="margin-top: 2px; font-size: 11px; color: var(--muted)">
                    Hover the "on the bus" entries in schedule to see a highlighted path on the map.
                </p>
                <div id="weekSchedule">Loading…</div>
            </div>
        </div>

        <div class="card" id="map">
            <!-- SVG map injected here -->
        </div>
    </div>

    <script src="./world_map_single.js"></script>
</body>

</html>